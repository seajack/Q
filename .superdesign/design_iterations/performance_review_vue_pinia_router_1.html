<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç»©æ•ˆè€ƒæ ¸ç³»ç»Ÿ Â· Vue + Pinia + Router åŸå‹ï¼ˆæ—  Tailwind/Flowbiteï¼‰</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <!-- Vue / Router / Pinia -->
  <script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/vue-router@4.3.2/dist/vue-router.global.prod.js"></script>
  <script src="https://unpkg.com/pinia@2.1.7/dist/pinia.iife.prod.js"></script>
  <!-- ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>

  <style>
    :root{
      /* å“ç‰Œè“ï¼ˆä¸ logo åè°ƒï¼Œå¯å¾®è°ƒï¼‰ */
      --brand-900:#0a4163;
      --brand-800:#0c537e;
      --brand-700:#0f689e;
      --brand-600:#177fc1; /* ä¸»è‰² */
      --brand-500:#2598e0;
      --brand-400:#4faee7;

      --bg:#ffffff; --fg:#111827; --muted:#f6f7f9; --border:#e5e7eb; --ring:rgba(23,127,193,.28);
    }
    html,body{height:100%}
    body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans"; background:var(--bg); color:var(--fg)}

    /* åŸºç¡€ UI */
    .container{max-width:1200px; margin:0 auto; padding:0 16px}
    .card{background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:0 1px 2px rgba(16,24,40,.06)}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:8px; border:1px solid var(--border); background:#fff; color:#374151; cursor:pointer}
    .btn:hover{background:#f8fafc}
    .btn-primary{background:var(--brand-600); color:#fff; border-color:var(--brand-600)}
    .btn-primary:hover{background:var(--brand-700); border-color:var(--brand-700)}
    .input, .select{padding:8px 12px; border:1px solid var(--border); border-radius:8px; font-size:14px; outline:none}
    .input:focus, .select:focus{box-shadow:0 0 0 3px var(--ring); border-color:var(--brand-600)}

    /* é¡¶éƒ¨å¯¼èˆª */
    header.topbar{position:sticky; top:0; z-index:40; background:#fff; border-bottom:1px solid var(--border)}
    .topbar-inner{height:56px; display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; color:#111}
    .brand img{height:32px; width:auto}

    nav.mainnav{background:var(--brand-600); color:#fff}
    .mainnav-inner{height:48px; display:flex; align-items:center; gap:18px; overflow:auto}
    .link{color:#fff; text-decoration:none; font-size:14px; white-space:nowrap; opacity:.95}
    .link.router-link-active{font-weight:700; text-decoration:underline}

    /* æ …æ ¼ */
    .grid{display:grid; gap:16px}
    .grid-4{grid-template-columns:repeat(4, minmax(0,1fr))}
    .grid-3{grid-template-columns:repeat(3, minmax(0,1fr))}
    .grid-12{grid-template-columns:repeat(12, minmax(0,1fr))}
    @media (max-width:1024px){.grid-4{grid-template-columns:repeat(2,1fr)} .grid-3{grid-template-columns:1fr}}
    @media (max-width:640px){.grid-4{grid-template-columns:1fr}}

    /* KPI å¡ */
    .kpi{padding:16px}
    .kpi-top{display:flex; align-items:center; justify-content:space-between; font-size:12px; color:#6b7280}
    .kpi-val{margin-top:10px; display:flex; align-items:flex-end; justify-content:space-between}
    .kpi-val h3{margin:0; font-size:24px}
    .badge{border-radius:999px; padding:2px 8px; font-size:12px}

    /* è¡¨æ ¼ */
    .table-wrap{overflow:hidden; border:1px solid var(--border); border-radius:12px}
    table{width:100%; border-collapse:collapse}
    thead th{position:sticky; top:0; background:#f9fafb; text-align:left; font-size:12px; color:#6b7280; text-transform:uppercase; padding:12px}
    tbody td{padding:12px; border-top:1px solid var(--border); font-size:14px}
    tbody tr:hover{background:#f9fafb}
    tbody tr:nth-child(even){background:#fafafa}

    /* å›¾è¡¨å®¹å™¨ */
    .chart{height:280px}

    /* å¸ƒå±€é—´è· */
    .mt-6{margin-top:24px} .mt-8{margin-top:32px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px}

    /* å·¥å…·æ¡ */
    .toolbar{display:flex; align-items:center; gap:8px}
  </style>
</head>

<body>
<div id="app">
  <!-- é¡¶éƒ¨å¯¼èˆªï¼ˆçº¯é¡¶éƒ¨ï¼‰ -->
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <img src="E:/code/Q/logo.png" alt="Logo" />
        <span>ç»©æ•ˆè€ƒæ ¸ç³»ç»Ÿ</span>
      </div>
      <div class="toolbar" style="display:none;" id="desktopSearch">
        <div style="position:relative">
          <input v-model.trim="$pinia.state.value.perf.keyword" placeholder="æœç´¢å‘˜å·¥ã€éƒ¨é—¨ã€æŒ‡æ ‡â€¦" class="input" style="width:280px"/>
          <span style="position:absolute;right:10px;top:50%;transform:translateY(-50%);color:#9ca3af">ğŸ”</span>
        </div>
      </div>
      <div class="toolbar">
        <select v-model="$pinia.state.value.perf.period" class="select">
          <option>2025 Q3</option><option>2025 Q2</option><option>2025 Q1</option><option>2024 Q4</option>
        </select>
        <button class="btn" @click="$router.push('/tasks')">ç­›é€‰</button>
        <button class="btn btn-primary" @click="alert('æ–°å¢è¯„å®¡ï¼ˆç¤ºæ„ï¼‰')">æ–°å¢è¯„å®¡</button>
      </div>
    </div>
    <nav class="mainnav">
      <div class="container mainnav-inner">
        <router-link class="link" to="/">é¦–é¡µ</router-link>
        <router-link class="link" to="/dashboard">è€ƒæ ¸çœ‹æ¿</router-link>
        <router-link class="link" to="/tasks">è¯„å®¡ä»»åŠ¡</router-link>
        <router-link class="link" to="/kpi">KPIæŒ‡æ ‡</router-link>
        <router-link class="link" to="/files">å‘˜å·¥æ¡£æ¡ˆ</router-link>
        <router-link class="link" to="/org">ç»„ç»‡æ¶æ„</router-link>
        <router-link class="link" to="/reports">æŠ¥è¡¨ä¸­å¿ƒ</router-link>
        <router-link class="link" to="/settings">ç³»ç»Ÿè®¾ç½®</router-link>
      </div>
    </nav>
  </header>

  <router-view></router-view>
</div>

<script>
const { createApp, ref, reactive, computed, onMounted } = Vue;
const { createRouter, createWebHashHistory } = VueRouter;
const { createPinia, defineStore } = Pinia;

// Pinia store
const usePerfStore = defineStore('perf', {
  state: () => ({
    period: '2025 Q3',
    keyword: '',
    rows: [
      { id:1, name:'Lee', role:'é«˜çº§äº§å“ç»ç†', dept:'äº§å“', target:92, grade:'A',  status:'å·²å®Œæˆ', color:'emerald' },
      { id:2, name:'Wang', role:'èµ„æ·±å‰ç«¯å·¥ç¨‹å¸ˆ', dept:'å¹³å°', target:75, grade:'B+', status:'è¿›è¡Œä¸­', color:'amber' },
      { id:3, name:'Zhang', role:'å•†åŠ¡æ‹“å±•', dept:'é”€å”®', target:58, grade:'C',  status:'å¾…è‡ªè¯„', color:'rose' },
      { id:4, name:'Li', role:'åç«¯å·¥ç¨‹å¸ˆ', dept:'å¹³å°', target:81, grade:'B+', status:'è¿›è¡Œä¸­', color:'amber' },
      { id:5, name:'Zhao', role:'ç®—æ³•å·¥ç¨‹å¸ˆ', dept:'äº§å“', target:88, grade:'A-', status:'å·²å®Œæˆ', color:'emerald' },
      { id:6, name:'Chen', role:'æ•°æ®åˆ†æå¸ˆ', dept:'å¹³å°', target:66, grade:'B',  status:'è¿›è¡Œä¸­', color:'amber' },
      { id:7, name:'Sun', role:'é”€å”®ç»ç†', dept:'é”€å”®', target:72, grade:'B',  status:'è¿›è¡Œä¸­', color:'amber' },
      { id:8, name:'Zhou', role:'äº§å“ç»ç†', dept:'äº§å“', target:95, grade:'A',  status:'å·²å®Œæˆ', color:'emerald' },
      { id:9, name:'Wu', role:'è®¾è®¡å¸ˆ', dept:'äº§å“', target:79, grade:'B+', status:'è¿›è¡Œä¸­', color:'amber' },
      { id:10, name:'Qian', role:'æµ‹è¯•å·¥ç¨‹å¸ˆ', dept:'å¹³å°', target:84, grade:'A-', status:'å·²å®Œæˆ', color:'emerald' },
      { id:11, name:'Lin', role:'å®æ–½é¡¾é—®', dept:'é”€å”®', target:63, grade:'C',  status:'å¾…è‡ªè¯„', color:'rose' }
    ],
  }),
});

// è§†å›¾ï¼šDashboardï¼ˆå›¾è¡¨ + KPI + è¡¨æ ¼ï¼‰
const Dashboard = {
  name:'Dashboard',
  setup(){
    const perf = Pinia.storeToRefs(usePerfStore()());
    // KPI ç¤ºä¾‹
    const kpi = reactive({ doneRate: 76, avgScore: 4.2, avgGrade: 'B+', pending: 18, anomaly: 8, anomalyRate: 12 });

    // å›¾è¡¨ refs
    const distRef = ref(null), deptRef = ref(null);
    let distChart, deptChart;

    const depts = computed(()=> Array.from(new Set(perf.rows.value.map(r=>r.dept))));

    // ç­›é€‰ + æ’åº + åˆ†é¡µ
    const GRADE_ORDER = ['A+','A','A-','B+','B','B-','C'];
    const sortKey = ref('name');
    const sortDir = ref('asc');
    const page = ref(1); const pageSize = ref(10);

    const filtered = computed(()=>{
      const kw = perf.keyword.value.trim().toLowerCase();
      let list = perf.rows.value;
      if (kw) list = list.filter(r=> `${r.name} ${r.dept} ${r.role}`.toLowerCase().includes(kw));
      return list;
    });

    const sorted = computed(()=>{
      return [...filtered.value].sort((a,b)=>{
        let va=a[sortKey.value], vb=b[sortKey.value];
        if (sortKey.value==='grade'){ va=GRADE_ORDER.indexOf(a.grade); vb=GRADE_ORDER.indexOf(b.grade); }
        if (typeof va==='string'){ va=va.toLowerCase(); vb=vb.toLowerCase(); }
        if (va<vb) return sortDir.value==='asc'?-1:1;
        if (va>vb) return sortDir.value==='asc'?1:-1;
        return 0;
      })
    });

    const maxPage = computed(()=> Math.max(1, Math.ceil(sorted.value.length / pageSize.value)));
    const pageRows = computed(()=>{
      const p = Math.min(Math.max(1,page.value), maxPage.value);
      const start = (p-1)*pageSize.value;
      return sorted.value.slice(start, start+pageSize.value);
    });

    const toggleSort = (k)=>{
      if (sortKey.value===k) sortDir.value = (sortDir.value==='asc'?'desc':'asc');
      else { sortKey.value=k; sortDir.value='asc'; }
    }

    const avatarGrad = (r)=> r.color==='emerald' ? 'linear-gradient(135deg, var(--brand-400), var(--brand-600))' : (r.color==='amber'?'linear-gradient(135deg, #f59e0b, #f97316)':'linear-gradient(135deg, #d946ef, #ec4899)');
    const gradeColor = (r)=> r.color==='rose' ? '#be123c' : (r.color==='emerald' ? '#047857' : '#b45309');
    const badgeStyle = (r)=> r.color==='emerald' ? 'background:#ecfdf5;color:#047857' : (r.color==='amber' ? 'background:#fffbeb;color:#b45309' : 'background:#fff1f2;color:#be123c');

    const initCharts = ()=>{
      const brand = getComputedStyle(document.documentElement).getPropertyValue('--brand-600').trim() || '#177fc1';
      distChart = echarts.init(distRef.value);
      distChart.setOption({ grid:{left:40,right:10,top:20,bottom:28}, tooltip:{trigger:'axis'}, xAxis:{type:'category',data:['C','B-','B','B+','A-','A','A+']}, yAxis:{type:'value',splitLine:{lineStyle:{color:'#eee'}}}, series:[{ type:'bar', data:[5,12,22,30,18,9,4], itemStyle:{ color: brand }, barWidth:'55%' }] });
      deptChart = echarts.init(deptRef.value);
      deptChart.setOption({ grid:{left:40,right:10,top:20,bottom:28}, tooltip:{}, xAxis:{type:'value',max:100}, yAxis:{type:'category',data:['äº§å“','å¹³å°','é”€å”®']}, series:[{ type:'bar', data:[82,70,61], itemStyle:{ color:(p)=>[brand,'#4faee7','#0f689e'][p.dataIndex%3] } }] });
      window.addEventListener('resize', ()=>{ distChart && distChart.resize(); deptChart && deptChart.resize(); });
    }

    onMounted(initCharts);

    return { perf, kpi, distRef, deptRef, depts, GRADE_ORDER, sortKey, sortDir, page, pageSize, maxPage, pageRows, toggleSort, avatarGrad, gradeColor, badgeStyle };
  },
  template:`
  <main class="container" style="padding:24px 16px">
    <!-- KPI -->
    <section class="grid grid-4">
      <div class="card kpi">
        <div class="kpi-top"><span>å·²å®Œæˆè¯„å®¡</span><span class="badge" style="background:#ecfdf5;color:#047857">+12%</span></div>
        <div class="kpi-val"><h3>{{kpi.doneRate}}%</h3><div style="height:32px;width:32px;border-radius:8px;background:linear-gradient(135deg,#34d399,#14b8a6)"></div></div>
        <div style="margin-top:10px;height:6px;border-radius:8px;background:#e5e7eb"><div :style="{height:'6px',width:kpi.doneRate+'%',background:'linear-gradient(90deg,#34d399,#14b8a6)',borderRadius:'8px'}"></div></div>
      </div>
      <div class="card kpi">
        <div class="kpi-top"><span>å¹³å‡è¯„åˆ†</span><span class="badge" style="background:#fffbeb;color:#b45309">{{kpi.avgScore}}</span></div>
        <div class="kpi-val"><h3>{{kpi.avgGrade}}</h3><div style="height:32px;width:32px;border-radius:8px;background:linear-gradient(135deg,#f59e0b,#f97316)"></div></div>
        <div style="margin-top:8px;font-size:12px;color:#6b7280"><span style="display:inline-block;height:8px;width:8px;background:var(--brand-600);border-radius:2px;margin-right:8px"></span>é«˜åˆ†é›†ä¸­äºäº§å“ä¸å¹³å°</div>
      </div>
      <div class="card kpi">
        <div class="kpi-top"><span>å¾…è¯„å®¡</span><span class="badge" style="background:#e6f4fb;color:var(--brand-700)">-5 äºº</span></div>
        <div class="kpi-val"><h3>18 äºº</h3><div style="height:32px;width:32px;border-radius:8px;background:linear-gradient(135deg,var(--brand-400),var(--brand-600))"></div></div>
        <div style="margin-top:10px;display:grid;grid-template-columns:repeat(5,1fr);gap:4px">
          <div style="height:6px;border-radius:6px;background:var(--brand-600);opacity:.9"></div>
          <div style="height:6px;border-radius:6px;background:var(--brand-600);opacity:.7"></div>
          <div style="height:6px;border-radius:6px;background:var(--brand-600);opacity:.5"></div>
          <div style="height:6px;border-radius:6px;background:var(--brand-600);opacity:.4"></div>
          <div style="height:6px;border-radius:6px;background:var(--brand-600);opacity:.3"></div>
        </div>
      </div>
      <div class="card kpi">
        <div class="kpi-top"><span>å¼‚å¸¸æ³¢åŠ¨</span><span class="badge" style="background:#ffe4e6;color:#be123c">{{kpi.anomaly}} å‘˜å·¥</span></div>
        <div class="kpi-val"><h3>{{kpi.anomalyRate}}%</h3><div style="height:32px;width:32px;border-radius:8px;background:linear-gradient(135deg,#fb7185,#ef4444)"></div></div>
        <div style="margin-top:8px;font-size:12px;color:#6b7280">è¿‘ä¸¤æœŸè¯„åˆ†å·®å¼‚ > 1.0</div>
      </div>
    </section>

    <!-- å›¾è¡¨ -->
    <section class="grid grid-3 mt-6">
      <div class="card" style="padding:16px; grid-column: span 2">
        <div class="row"><h3 style="margin:0;font-size:16px">è¯„åˆ†åˆ†å¸ƒ</h3><button class="btn" onclick="alert('å¯¼å‡ºï¼ˆç¤ºæ„ï¼‰')">å¯¼å‡º</button></div>
        <div ref="distRef" class="chart"></div>
      </div>
      <div class="card" style="padding:16px;">
        <div class="row"><h3 style="margin:0;font-size:16px">éƒ¨é—¨å®Œæˆåº¦</h3><span style="font-size:12px;color:#6b7280">ç›®æ ‡ 100%</span></div>
        <div ref="deptRef" class="chart"></div>
      </div>
    </section>

    <!-- è¡¨æ ¼ -->
    <section class="mt-8">
      <div class="row"><h3 style="margin:0;font-size:16px">å‘˜å·¥ç»©æ•ˆ</h3><div class="toolbar"><span style="font-size:12px;color:#6b7280">æ¯é¡µ</span><select v-model.number="pageSize" class="select"><option :value="5">5</option><option :value="10">10</option><option :value="20">20</option></select><span style="font-size:12px;color:#6b7280">æ¡</span></div></div>
      <div class="table-wrap mt-6">
        <table>
          <thead>
            <tr>
              <th><button class="btn" onclick="return false" @click="toggleSort('name')">å‘˜å·¥ â–²â–¼</button></th>
              <th><button class="btn" onclick="return false" @click="toggleSort('dept')">éƒ¨é—¨ â–²â–¼</button></th>
              <th><button class="btn" onclick="return false" @click="toggleSort('target')">ç›®æ ‡è¾¾æˆ â–²â–¼</button></th>
              <th><button class="btn" onclick="return false" @click="toggleSort('grade')">è¯„åˆ† â–²â–¼</button></th>
              <th>çŠ¶æ€</th>
              <th style="text-align:right">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(r,i) in pageRows" :key="r.id">
              <td>
                <div style="display:flex;align-items:center;gap:12px">
                  <span :style="{height:'32px',width:'32px',display:'inline-flex',alignItems:'center',justifyContent:'center',borderRadius:'8px',background:avatarGrad(r),color:'#fff',fontWeight:'700'}">{{ r.name.charAt(0) }}</span>
                  <div>
                    <div style="font-weight:600">{{ r.name }}</div>
                    <div style="font-size:12px;color:#6b7280">{{ r.role }}</div>
                  </div>
                </div>
              </td>
              <td style="font-size:14px">{{ r.dept }}</td>
              <td style="font-size:14px">{{ r.target }}%</td>
              <td :style="{color:gradeColor(r),fontWeight:'600'}">{{ r.grade }}</td>
              <td><span class="badge" :style="badgeStyle(r)">{{ r.status }}</span></td>
              <td style="text-align:right">
                <div class="toolbar"><button class="btn" @click="alert('è¯¦æƒ…ï¼š'+r.name)">è¯¦æƒ…</button><button class="btn btn-primary" @click="alert('ç¼–è¾‘ï¼š'+r.name)">ç¼–è¾‘</button></div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="row" style="margin-top:12px;font-size:12px;color:#374151">
        <div>å…± {{ sorted.length }} äºº Â· ç¬¬ {{ page }} / {{ maxPage }} é¡µ</div>
        <div class="toolbar"><button class="btn" @click="page=Math.max(1,page-1)">ä¸Šä¸€é¡µ</button><button class="btn" @click="page=Math.min(maxPage,page+1)">ä¸‹ä¸€é¡µ</button></div>
      </div>
    </section>
  </main>
  `
};

// å…¶ä»–è·¯ç”±å ä½
const Placeholder = (name)=>({
  name,
  template:`<main class="container" style="padding:24px 16px"><div class="card" style="padding:20px"><h3 style="margin:0 0 8px 0">${name}</h3><p style="margin:0;color:#6b7280">æ­¤é¡µé¢ä¸ºå ä½ï¼Œåç»­æ¥å…¥çœŸå®åŠŸèƒ½ã€‚</p></div></main>`
});

// è·¯ç”±
const router = createRouter({
  history: createWebHashHistory(),
  routes:[
    { path:'/', redirect:'/dashboard' },
    { path:'/dashboard', component: Dashboard },
    { path:'/tasks', component: Placeholder('è¯„å®¡ä»»åŠ¡') },
    { path:'/kpi', component: Placeholder('KPI æŒ‡æ ‡') },
    { path:'/files', component: Placeholder('å‘˜å·¥æ¡£æ¡ˆ') },
    { path:'/org', component: Placeholder('ç»„ç»‡æ¶æ„') },
    { path:'/reports', component: Placeholder('æŠ¥è¡¨ä¸­å¿ƒ') },
    { path:'/settings', component: Placeholder('ç³»ç»Ÿè®¾ç½®') },
  ]
});

// å¯åŠ¨
const app = createApp({});
const pinia = createPinia();
app.use(pinia); app.use(router);
// æ³¨å†Œ store ä»¥ä¾¿æ¨¡æ¿ç›´æ¥è®¿é—® $pinia.state.value.perf
const perfStore = usePerfStore();
app.mount('#app');
</script>
</body>
</html>
