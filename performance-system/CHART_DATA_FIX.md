# 首页图表数据问题解决方案

## 问题分析

绩效考核系统首页的图表没有数据显示，经过分析发现以下问题：

### 1. 后端API数据正常
- `/api/stats/overview/` 接口返回完整数据
- 包含 `score_distribution`、`dept_performance`、`performance_trend`、`cycle_progress` 等图表数据
- 数据结构和内容都正确

### 2. 前端图表渲染问题
- 图表初始化时机不当
- DOM元素可能未准备好
- 缺少调试信息

## 解决方案

### 1. 修复图表初始化时机
```javascript
onMounted(async () => {
  // 先初始化图表
  initCharts()
  
  // 等待下一个tick确保DOM元素已准备好
  await nextTick()
  
  // 加载数据
  await loadData()
})
```

### 2. 添加调试信息
为每个图表渲染函数添加了调试日志：
- 检查图表实例是否初始化
- 输出数据内容
- 记录渲染过程

### 3. 数据验证
后端API返回的数据结构：
```json
{
  "score_distribution": {
    "A+": 3, "A": 1, "A-": 1, "B+": 0, "B": 1, "B-": 0, "C": 0
  },
  "dept_performance": [
    {
      "department": "中煤内蒙古公司",
      "completion_rate": 100.0,
      "avg_score": 86.8
    }
  ],
  "performance_trend": [
    {"date": "2025-10-02", "completed": 0}
  ],
  "cycle_progress": [
    {
      "name": "2025年第四季度考核",
      "progress": 0
    }
  ]
}
```

## 测试验证

### 1. 创建测试页面
- `test_charts.html` - 独立的图表测试页面
- 可以验证API数据和图表渲染

### 2. 调试步骤
1. 打开浏览器开发者工具
2. 访问首页
3. 查看控制台输出
4. 检查图表数据加载情况

### 3. 预期结果
- 控制台应显示图表数据日志
- 图表应正常渲染数据
- 无JavaScript错误

## 可能的问题

### 1. 图表容器尺寸
- 确保图表容器有明确的宽高
- 检查CSS样式是否正确

### 2. ECharts版本兼容性
- 确保使用兼容的ECharts版本
- 检查图表配置语法

### 3. 数据格式问题
- 确保数据格式符合ECharts要求
- 检查空数据处理

## 后续优化建议

1. **错误处理**: 添加更完善的错误处理机制
2. **加载状态**: 显示图表加载状态
3. **数据缓存**: 避免重复请求相同数据
4. **响应式**: 确保图表在不同屏幕尺寸下正常显示

## 使用方法

1. 确保后端服务运行在 `http://127.0.0.1:8001`
2. 打开 `test_charts.html` 进行测试
3. 点击"测试API数据"按钮
4. 点击"测试图表渲染"按钮
5. 检查图表是否正常显示数据
