# è€ƒæ ¸è§„åˆ™å…³ç³»ç±»å‹ç®—æ³•åˆ†æ

## ğŸ“‹ **å…³ç³»ç±»å‹å®šä¹‰**

### 1. **ä¸Šçº§è¯„ä¸‹çº§ (superior)**
**ç®—æ³•é€»è¾‘**:
- éå†æ‰€æœ‰å‘˜å·¥ï¼Œæ‰¾åˆ°æœ‰ç›´æ¥ä¸Šçº§çš„å‘˜å·¥
- æ£€æŸ¥ä¸Šçº§æ˜¯å¦å­˜åœ¨äºæœ¬åœ°å‘˜å·¥åº“ä¸­
- éªŒè¯æ˜¯å¦å…è®¸è·¨éƒ¨é—¨/è·¨å•ä½è¯„ä»·
- åˆ›å»ºä¸Šçº§å¯¹ä¸‹çº§çš„è€ƒæ ¸ä»»åŠ¡

**æ ¸å¿ƒä»£ç **:
```python
def _generate_superior_tasks(self) -> int:
    for org_emp in self.org_employees_data:
        if org_emp.get('supervisor'):  # æœ‰ç›´æ¥ä¸Šçº§
            supervisor_org = self.org_employee_map.get(org_emp['supervisor'])
            if supervisor_org and self._is_evaluation_allowed(supervisor_org, org_emp):
                # åˆ›å»ºè€ƒæ ¸ä»»åŠ¡
```

### 2. **åŒçº§äº’è¯„ (peer)**
**ç®—æ³•é€»è¾‘**:
- æ ¹æ®è¯„ä»·èŒƒå›´ï¼ˆéƒ¨é—¨/å•ä½/å…¬å¸ï¼‰æŸ¥æ‰¾åŒçº§åŒäº‹
- åŒçº§åˆ¤æ–­æ ‡å‡†ï¼šåŒä¸€ä¸Šçº§æˆ–èŒä½çº§åˆ«ç›¸è¿‘
- é™åˆ¶è¯„ä»·äººæ•°ï¼ˆmax_evaluators_per_relationï¼‰
- æ’é™¤è‡ªå·±å’Œä¸Šçº§

**æ ¸å¿ƒä»£ç **:
```python
def _find_peers(self, org_emp):
    if self.rule.evaluation_scope == 'department':
        # åŒéƒ¨é—¨åŒçº§ï¼šåŒä¸€ä¸Šçº§
        peers = [emp for emp in self.org_employees_data 
                if emp['department'] == org_emp['department'] 
                and emp.get('supervisor') == org_emp.get('supervisor')]
    elif self.rule.evaluation_scope == 'company':
        # å…¨å…¬å¸åŒçº§ï¼šèŒä½çº§åˆ«ç›¸è¿‘
        peers = [emp for emp in self.org_employees_data 
                if abs(emp.get('position_level', 0) - org_emp.get('position_level', 0)) <= self.rule.position_level_diff_limit]
```

### 3. **ä¸‹çº§è¯„ä¸Šçº§ (subordinate)**
**ç®—æ³•é€»è¾‘**:
- éå†æ‰€æœ‰å‘˜å·¥ï¼Œæ‰¾åˆ°æœ‰ç›´æ¥ä¸‹å±çš„å‘˜å·¥
- é™åˆ¶è¯„ä»·äººæ•°
- éªŒè¯è¯„ä»·æƒé™

**æ ¸å¿ƒä»£ç **:
```python
def _generate_subordinate_tasks(self) -> int:
    for org_emp in self.org_employees_data:
        subordinates = [emp for emp in self.org_employees_data 
                       if emp.get('supervisor') == org_emp['id']]
        selected_subordinates = subordinates[:max_evaluators]
```

### 4. **è‡ªè¯„ (self)**
**ç®—æ³•é€»è¾‘**:
- æ£€æŸ¥è§„åˆ™æ˜¯å¦å…è®¸è‡ªè¯„ (allow_self_evaluation)
- ä¸ºæ¯ä¸ªå‘˜å·¥åˆ›å»ºè‡ªè¯„ä»»åŠ¡

**æ ¸å¿ƒä»£ç **:
```python
def _generate_self_tasks(self) -> int:
    if not self.rule.allow_self_evaluation:
        return 0
    for org_emp in self.org_employees_data:
        # åˆ›å»ºå‘˜å·¥å¯¹è‡ªå·±çš„è¯„ä»·ä»»åŠ¡
```

### 5. **è·¨éƒ¨é—¨ä¸Šçº§ (cross_superior)**
**ç®—æ³•é€»è¾‘**:
- éœ€è¦å…è®¸è·¨éƒ¨é—¨ (allow_cross_department=True)
- è¯†åˆ«è·¨éƒ¨é—¨çš„ä¸Šçº§å…³ç³»
- ç›®å‰å®ç°è¾ƒç®€åŒ–

### 6. **è·¨éƒ¨é—¨åŒçº§ (cross_peer)**
**ç®—æ³•é€»è¾‘**:
- éœ€è¦å…è®¸è·¨éƒ¨é—¨ (allow_cross_department=True)
- è¯†åˆ«è·¨éƒ¨é—¨çš„åŒçº§å…³ç³»
- ç›®å‰å®ç°è¾ƒç®€åŒ–

### 7. **è‡ªå®šä¹‰å…³ç³» (custom)**
**ç®—æ³•é€»è¾‘**:
- é€šè¿‡æ‰‹åŠ¨åˆ†é… (ManualEvaluationAssignment) å®ç°
- æ”¯æŒå®Œå…¨è‡ªå®šä¹‰çš„è¯„ä»·å…³ç³»

## ğŸ¢ **èŒçº§ä½“ç³»å®šä¹‰**

### **ç®¡ç†å±‚çº§åˆ†ç±»**
```python
MANAGEMENT_LEVEL_CHOICES = [
    ('senior', 'é«˜å±‚'),
    ('middle', 'ä¸­å±‚'), 
    ('junior', 'åŸºå±‚'),
]
```

### **èŒä½çº§åˆ«ä½“ç³»ï¼ˆæ•°å­—è¶Šå¤§çº§åˆ«è¶Šé«˜ï¼‰**
```python
POSITION_LEVEL_CHOICES = [
    (13, 'é«˜å±‚æ­£èŒ'),    # è‘£äº‹é•¿ã€æ€»ç»ç†
    (12, 'é«˜å±‚å‰¯èŒ'),    # å‰¯æ€»ç»ç†
    (11, 'é«˜å±‚åŠ©ç†'),    # æ€»ç»ç†åŠ©ç†
    (9, 'ä¸­å±‚æ­£èŒ'),     # éƒ¨é—¨ç»ç†
    (8, 'ä¸­å±‚å‰¯èŒ'),     # å‰¯ç»ç†
    (7, 'ä¸­å±‚åŠ©ç†'),     # ç»ç†åŠ©ç†
    (4, 'åŸºå±‚æ­£èŒ'),     # ä¸»ç®¡
    (3, 'åŸºå±‚å‰¯èŒ'),     # å‰¯ä¸»ç®¡
    (2, 'åŸºå±‚åŠ©ç†'),     # åŠ©ç†
    (1, 'å‘˜å·¥'),         # æ™®é€šå‘˜å·¥
]
```

## âš–ï¸ **æƒé‡åˆ†é…ç®—æ³•**

### **åŸºç¡€æƒé‡é…ç½®**
```python
base_weights = {
    'superior': 0.60,     # ä¸Šçº§è€ƒæ ¸æƒé‡60%
    'peer': 0.25,         # åŒçº§äº’è¯„æƒé‡25%
    'subordinate': 0.15,  # ä¸‹çº§è¯„ä»·æƒé‡15%
}
```

### **èŒä½çº§åˆ«æƒé‡è°ƒæ•´**
```python
level_multipliers = {
    1: 1.0,  # åˆçº§
    2: 1.0,  # åˆçº§
    3: 1.2,  # ä¸­çº§
    4: 1.2,  # ä¸­çº§
    5: 1.5,  # é«˜çº§
    6: 1.5,  # é«˜çº§
    7: 2.0,  # ç®¡ç†çº§
    8: 2.0,  # ç®¡ç†çº§
}
```

## ğŸ” **è¯„ä»·æƒé™éªŒè¯**

### **è·¨éƒ¨é—¨é™åˆ¶**
```python
if not self.rule.allow_cross_department and evaluator_org['department'] != evaluatee_org['department']:
    return False
```

### **è·¨å•ä½é™åˆ¶**
```python
if not self.rule.allow_cross_unit and evaluator_org.get('unit_id') != evaluatee_org.get('unit_id'):
    return False
```

### **èŒä½çº§åˆ«å·®è·é™åˆ¶**
```python
if abs(evaluator_level - evaluatee_level) > self.rule.position_level_diff_limit:
    return False
```

## ğŸ“Š **è§„åˆ™é…ç½®ç¤ºä¾‹**

### **360åº¦å…¨æ–¹ä½è¯„ä»·**
```python
{
    'relation_types': ['superior', 'peer', 'subordinate', 'self'],
    'relation_weights': {
        'superior': 0.5,
        'peer': 0.3,
        'subordinate': 0.1,
        'self': 0.1
    },
    'allow_cross_department': False,
    'position_level_diff_limit': 2
}
```

### **æœ¬éƒ¨é—¨ä¸Šçº§è¯„ä¸‹çº§**
```python
{
    'relation_types': ['superior'],
    'relation_weights': {'superior': 1.0},
    'allow_cross_department': False,
    'position_level_diff_limit': 2
}
```

## ğŸ¯ **ç®—æ³•ç‰¹ç‚¹**

1. **çµæ´»æ€§**: æ”¯æŒå¤šç§å…³ç³»ç±»å‹ç»„åˆ
2. **å¯é…ç½®æ€§**: æƒé‡ã€èŒƒå›´ã€é™åˆ¶éƒ½å¯è‡ªå®šä¹‰
3. **å±‚çº§æ„ŸçŸ¥**: åŸºäºèŒçº§ä½“ç³»çš„æ™ºèƒ½åŒ¹é…
4. **æƒé™æ§åˆ¶**: ä¸¥æ ¼çš„è·¨éƒ¨é—¨/è·¨å•ä½é™åˆ¶
5. **äººæ•°æ§åˆ¶**: æ¯ç§å…³ç³»ç±»å‹çš„è¯„ä»·äººæ•°é™åˆ¶

## ğŸ”§ **æ‰©å±•æ€§**

- æ”¯æŒè‡ªå®šä¹‰å…³ç³»ç±»å‹
- æ”¯æŒå¤æ‚çš„æƒé‡è®¡ç®—
- æ”¯æŒå¤šç»´åº¦è¯„ä»·èŒƒå›´
- æ”¯æŒæ‰‹åŠ¨åˆ†é…è¦†ç›–
