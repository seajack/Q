<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>头像功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .avatar-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .avatar-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1890ff, #096dd9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 24px;
        }
        .avatar-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e5e7eb;
        }
        .upload-btn {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .upload-btn:hover {
            background: #096dd9;
        }
        .user-info {
            flex: 1;
        }
        .info-item {
            margin: 5px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>头像功能测试</h1>
        
        <div class="avatar-section">
            <div id="avatar-display">
                <div class="avatar-circle" id="avatar-circle">U</div>
                <img id="avatar-image" class="avatar-image" style="display: none;" />
            </div>
            <div class="user-info">
                <div class="info-item"><strong>用户名:</strong> <span id="username">Admin</span></div>
                <div class="info-item"><strong>姓名:</strong> <span id="name">系统管理员</span></div>
                <div class="info-item"><strong>角色:</strong> <span id="role">系统管理员</span></div>
            </div>
            <button class="upload-btn" onclick="uploadAvatar()">上传头像</button>
        </div>
        
        <div id="status"></div>
        
        <h3>当前localStorage数据:</h3>
        <pre id="localStorage-data"></pre>
        
        <h3>测试功能:</h3>
        <button onclick="loadUserInfo()">加载用户信息</button>
        <button onclick="clearUserInfo()">清除用户信息</button>
        <button onclick="setTestUser()">设置测试用户</button>
    </div>

    <script>
        // 模拟用户信息
        const testUser = {
            username: 'admin',
            name: '系统管理员',
            role: '系统管理员',
            email: 'admin@company.com',
            phone: '13800138000',
            department: '信息部',
            position: '系统管理员',
            positionLevel: 'L9',
            bio: '负责系统管理和维护工作',
            avatar: ''
        };

        // 加载用户信息
        function loadUserInfo() {
            const user = localStorage.getItem('user');
            if (user) {
                const userData = JSON.parse(user);
                document.getElementById('username').textContent = userData.name || 'Admin';
                document.getElementById('name').textContent = userData.name || '系统管理员';
                document.getElementById('role').textContent = userData.role || '系统管理员';
                
                if (userData.avatar) {
                    document.getElementById('avatar-circle').style.display = 'none';
                    document.getElementById('avatar-image').style.display = 'block';
                    document.getElementById('avatar-image').src = userData.avatar;
                } else {
                    document.getElementById('avatar-circle').style.display = 'flex';
                    document.getElementById('avatar-image').style.display = 'none';
                    document.getElementById('avatar-circle').textContent = (userData.name || 'U').charAt(0).toUpperCase();
                }
                
                showStatus('用户信息加载成功', 'success');
            } else {
                showStatus('未找到用户信息', 'error');
            }
            updateLocalStorageDisplay();
        }

        // 上传头像
        function uploadAvatar() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // 验证文件类型
                if (!file.type.startsWith('image/')) {
                    showStatus('请选择图片文件', 'error');
                    return;
                }
                
                // 验证文件大小 (2MB)
                if (file.size > 2 * 1024 * 1024) {
                    showStatus('图片大小不能超过2MB', 'error');
                    return;
                }
                
                // 创建预览URL
                const previewUrl = URL.createObjectURL(file);
                
                // 更新显示
                document.getElementById('avatar-circle').style.display = 'none';
                document.getElementById('avatar-image').style.display = 'block';
                document.getElementById('avatar-image').src = previewUrl;
                
                // 更新localStorage
                const userInfo = JSON.parse(localStorage.getItem('user') || '{}');
                userInfo.avatar = previewUrl;
                localStorage.setItem('user', JSON.stringify(userInfo));
                
                showStatus('头像上传成功', 'success');
                updateLocalStorageDisplay();
            };
            input.click();
        }

        // 设置测试用户
        function setTestUser() {
            localStorage.setItem('user', JSON.stringify(testUser));
            showStatus('测试用户设置成功', 'success');
            loadUserInfo();
        }

        // 清除用户信息
        function clearUserInfo() {
            localStorage.removeItem('user');
            showStatus('用户信息已清除', 'success');
            updateLocalStorageDisplay();
        }

        // 显示状态
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // 更新localStorage显示
        function updateLocalStorageDisplay() {
            const user = localStorage.getItem('user');
            document.getElementById('localStorage-data').textContent = user ? JSON.stringify(JSON.parse(user), null, 2) : '无数据';
        }

        // 页面加载时初始化
        window.onload = function() {
            loadUserInfo();
        };
    </script>
</body>
</html>
